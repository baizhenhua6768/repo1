<?xml version="1.0" encoding="UTF-8"?>
<sqlMap namespace="guideCust" jdbcTimeout="5">

    <sql id="deleteRelByCustNoAndStaffId">
        <![CDATA[
			UPDATE o2o_staff_cust_rel
			SET delete_flag= 1,
			 delete_time= now()
			WHERE
				staff_id= :staffId
			AND cust_no= :custNo				
 		]]>
    </sql>

    <sql id="findRelByCustNoAndStaffId">
        <![CDATA[
			SELECT
				id,staff_id,staff_name,cust_no,store_code,channel,DATE_FORMAT(create_time,"%Y-%m-%d %T") as create_time,business_type
			FROM
				o2o_staff_cust_rel
			WHERE
				staff_id = :staffId and cust_no = :custNo and delete_flag = 0
			
 		]]>
    </sql>

    <sql id="queryStaffCustListByCustNo">
        <![CDATA[
			SELECT
				id,staff_id,staff_name,cust_no,store_code,channel,DATE_FORMAT(create_time,"%Y-%m-%d %T") as create_time,business_type
			FROM
				o2o_staff_cust_rel
			WHERE
				cust_no = :custNo and delete_flag = 0
			
 		]]>
    </sql>

    <sql id="queryRelByCustNo">
        <![CDATA[
			SELECT id,staff_id,staff_name,cust_no,store_code
			FROM o2o_staff_cust_rel
			WHERE cust_no = :custNo and delete_flag = 0
			LIMIT 0, 1
 		]]>
    </sql>

    <sql id="queryManagerByCustNo">
        <![CDATA[
			SELECT
				id,
				staff_id as staffId,
				staff_name as staffName,
				cust_no as custNo,
				store_code as storeCode,
				channel as channel,
				create_time as createTime,
				business_type as businessType,
				delete_flag as deleteFlag,
				delete_time as deleteTime
			FROM
				o2o_staff_cust_rel
			WHERE cust_no = :custNo and delete_flag = 0
 		]]>
    </sql>

    <sql id="queryManagerByCustNoAndBusiness">
        <![CDATA[
			SELECT
				id,
				staff_id as staffId,
				staff_name as staffName,
				cust_no as custNo,
				store_code as storeCode,
				channel as channel,
				create_time as createTime,
				business_type as businessType,
				delete_flag as deleteFlag,
				delete_time as deleteTime
			FROM
				o2o_staff_cust_rel
			WHERE cust_no = :custNo and delete_flag = 0 and business_type =:businessType
 		]]>
    </sql>

    <sql id="deleteFlagById">
        <![CDATA[
			UPDATE
				o2o_staff_cust_rel
			SET
				delete_flag = 1,
				delete_time = now()
			WHERE
				id = :id
 		]]>
    </sql>

    <!--pc获取门店下所有导购信息-->
    <sql id="getStoreServants">
        <![CDATA[
 			SELECT
               	 	g.GUIDE_ID  guideId,
             		g.GUIDE_NAME  guideName,
            		g.GUIDE_PHOTO guidePhoto,
             		g.INTRODUCTION introduction,
              		g.CATEGORY_NAME categoryName
            FROM
                		o2o_v_guide_info g
			where
					g.STORE_CODE=:storeCode and g.OPEN_FLAG='1' and g.business_type='1'
    	]]>
    </sql>

    <!--pc获取门店基本信息-->
    <sql id="getPcStoreInfo">
        <![CDATA[
            select  STORE_CODE          storeCode,
                    CITY_ID             cityCode,
                    NAME                name,
                    ADDRESS             address,
                    LONGITUDE           longitude,
                    LATITUDE            latitude,
                    WORKDAY_BEGIN_TIME  workdayBeginTime,
                    WORKDAY_END_TIME    workdayEndTime,
                    WEEKEND_BEGIN_TIME  weekendBeginTime,
                    WEEKEND_END_TIME    weekendEndTime
            from        o2o_store_detail
            where   STORE_CODE=:storeCode
                    and STORE_STATUS='1'
        ]]>
    </sql>

</sqlMap>
	
