<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="storeInfo" jdbcTimeout="5">

    <sql id="replaceInto">
        <![CDATA[
            REPLACE INTO
                store_info (store_id,store_address,store_code)
            VALUES
                (:storeInfo.storeId,:storeInfo.storeAddress,:storeInfo.storeCode);
        ]]>
    </sql>

    <sql id="queryStoreInfo">
        <![CDATA[
        select
            store_id as storeId,
            store_address as storeAddress,
            store_code as storeCode,
            CREATER as creater,
            CREATE_TIME as createTime,
            UPDATER as updater,
            UPDATE_TIME as updateTime
        from store_info
        where store_code =:storeCode
        ]]>
    </sql>

    <!-- 查询有效门店数量（包含有效V购的门店） -->
    <sql id="queryStoreCount">
        <![CDATA[
            SELECT COUNT(1)
            FROM store_info s
            WHERE s.latitude IS NOT NULL
            AND s.longitude IS NOT NULL
            AND EXISTS
                (SELECT 1 FROM o2o_v_guide_info g
                    WHERE g.store_code = s.store_code
                    AND g.delete_flag = 0
                    AND g.is_Vgo = 1
                    AND g.dimission_flag = '0'
                    AND g.open_flag = '1')
        ]]>
    </sql>

    <!-- 分页查询门店列表 -->
    <sql id="queryStorePageList">
        <![CDATA[
            SELECT
                s.store_id as storeId,
                s.store_code as storeCode,
                s.store_name as storeName,
                s.latitude as latitude,
                s.longitude as longitude,
                s.business_type as businessType
            FROM store_info s
            WHERE s.latitude IS NOT NULL
            AND s.longitude IS NOT NULL
            AND EXISTS
                (SELECT 1 FROM o2o_v_guide_info g
                    WHERE g.store_code = s.store_code
                    AND g.delete_flag = 0
                    AND g.is_Vgo = 1
                    AND g.dimission_flag = '0'
                    AND g.open_flag = '1')
            LIMIT :offset, :size
        ]]>
    </sql>

    <!-- 查询门店信息 -->
    <sql id="queryStoreGeoInfo">
        <![CDATA[
            SELECT
                s.store_id as storeId,
                s.store_code as storeCode,
                s.store_name as storeName,
                s.latitude as latitude,
                s.longitude as longitude,
                s.business_type as businessType
            FROM store_info s
            WHERE store_code = :storeCode
            AND latitude IS NOT NULL
            AND longitude IS NOT NULL
            LIMIT 0, 1
        ]]>
    </sql>

    <!-- 查询门店下有效导购数量 -->
    <sql id="queryValidVgoCount">
        <![CDATA[
            SELECT COUNT(1)
            FROM store_info s, o2o_v_guide_info g
            WHERE latitude IS NOT NULL
            AND longitude IS NOT NULL
            AND s.store_code = g.STORE_CODE
            AND g.delete_flag = 0
            AND g.is_Vgo = 1
            AND g.dimission_flag = '0'
            AND g.OPEN_FLAG = '1'
            AND g.STORE_CODE = :storeCode
        ]]>
    </sql>
</sqlMap>
