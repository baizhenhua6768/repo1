<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="customerLabelRelation" jdbcTimeout="5">

    <sql id="queryRequiredLabelList">
        <![CDATA[
			SELECT
	            a.id,
	            a.id as labelNo,
	            a.label_name as labelName,
	            CASE WHEN r.id IS NULL THEN 0
                ELSE 1 END AS checked
            FROM
	            mb_label_info a
            LEFT JOIN mb_customer_label_relation r ON a.id = r.label_id
            and r.staff_id = :staffId and r.union_id = :unionId
            WHERE a.mandatory_flag = 1
 		]]>
    </sql>

    <sql id="queryRequiredLabelTypeList">
        <![CDATA[
			SELECT
	            distinct
	            a.group_id as labelGroupId,
	            a.group_name as labelGroupName
            FROM
	            mb_label_info a
            LEFT JOIN mb_customer_label_relation r ON a.id = r.label_id
            and r.staff_id = :staffId and r.union_id = :unionId
            WHERE a.mandatory_flag = 1
 		]]>
    </sql>

    <sql id="queryOtherLabelList">
        <![CDATA[
			SELECT
	            a.id,
	            a.id as labelNo,
	            a.label_name as labelName,
	            CASE WHEN r.id IS NULL THEN 0
                ELSE 1 END AS checked
            FROM
	            mb_label_info a
            LEFT JOIN mb_customer_label_relation r ON a.id = r.label_id
            and r.staff_id = :staffId and r.union_id = :unionId
            WHERE a.mandatory_flag = 0 and a.group_id = 0
 		]]>
    </sql>


    <sql id="deleteLabelRelation">
        <![CDATA[
			  delete from mb_customer_label_relation
			    where
			    union_id = :unionId
			    and staff_id = :staffId
 		]]>
    </sql>

    <sql id="queryCustomerLabelInfo">
        <![CDATA[
		 SELECT
            GROUP_CONCAT(
                mli.label_name
                ORDER BY
                    mli.mandatory_flag desc
            ) labelName
            FROM
                mb_customer_label_relation clr
            JOIN mb_label_info mli ON clr.label_id = mli.id
           where clr.union_id = :unionId
 		]]>
    </sql>

    <sql id="queryCustomerLabelList">
        <![CDATA[
		    select
			    b.label_name
	        from mb_customer_label_relation a, mb_label_info b
			where
			    a.label_id = b.id
			and staff_id = :staffId and union_id = :unionId
 		]]>
    </sql>

</sqlMap>