<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="staff" jdbcTimeout="5">

    <sql id="queryStationList">
        <![CDATA[
        select
            DISTINCT station
        from
            staff_white_list
        ]]>
    </sql>

    <sql id="queryStaffInfoPage">
        <![CDATA[
        select
            s.id as id,
            s.staff_id as staffId,
            s.staff_name as staffName,
            s.area_name as areaName,
            s.company_name as companyName,
            s.store_name as storeName,
            s.station,
            s.valid_flag as validFlag,
            s.error_falg as errorFlag
        from staff_white_list s
        where s.delete_falg <> 2
        <#if staffInfoDTO.staffId?exists && staffInfoDTO.staffId != "">
          and s.staff_id =:staffInfoDTO.staffId
        </#if>
        <#if staffInfoDTO.staffName?exists && staffInfoDTO.staffName != "">
          and s.staff_name =:staffInfoDTO.staffName
        </#if>
        <#if staffInfoDTO.areaCode?exists && staffInfoDTO.areaCode != "">
          and s.area_code =:staffInfoDTO.areaCode
        </#if>
        <#if staffInfoDTO.companyCode?exists && staffInfoDTO.companyCode != "">
          and s.company_code =:staffInfoDTO.companyCode
        </#if>
        <#if staffInfoDTO.storeCode?exists && staffInfoDTO.storeCode != "">
          and s.store_code =:staffInfoDTO.storeCode
        </#if>
        <#if staffInfoDTO.station?exists && staffInfoDTO.station != "">
          and s.station =:staffInfoDTO.station
        </#if>
        <#if staffInfoDTO.validFlag?exists>
          and s.valid_flag =:staffInfoDTO.validFlag
        </#if>
        order by s.UPDATE_TIME desc
        limit :offset,:size
        ]]>
    </sql>

    <sql id="queryStaffInfoPage#count">
        <![CDATA[
        select count(*)
        from staff_white_list s
        where s.delete_falg <> 2
        <#if staffInfoDTO.staffId?exists && staffInfoDTO.staffId != "">
          and s.staff_id =:staffInfoDTO.staffId
        </#if>
        <#if staffInfoDTO.staffName?exists && staffInfoDTO.staffName != "">
          and s.staff_name =:staffInfoDTO.staffName
        </#if>
        <#if staffInfoDTO.areaCode?exists && staffInfoDTO.areaCode != "">
          and s.area_code =:staffInfoDTO.areaCode
        </#if>
        <#if staffInfoDTO.companyCode?exists && staffInfoDTO.companyCode != "">
          and s.company_code =:staffInfoDTO.companyCode
        </#if>
        <#if staffInfoDTO.storeCode?exists && staffInfoDTO.storeCode != "">
          and s.store_code =:staffInfoDTO.storeCode
        </#if>
        <#if staffInfoDTO.station?exists && staffInfoDTO.station != "">
          and s.station =:staffInfoDTO.station
        </#if>
        <#if staffInfoDTO.validFlag?exists>
          and s.valid_flag =:staffInfoDTO.validFlag
        </#if>
        ]]>
    </sql>

    <sql id="deleteStaffInfo">
        <![CDATA[
        delete from staff_white_list where id in (:idList)
        ]]>
    </sql>

    <sql id="modifyStaffStatus">
        <![CDATA[
        update staff_white_list set valid_flag = :validFlag,UPDATER =:updateUser,UPDATE_TIME = SYSDATE()
        where id in(:idList)
        ]]>
    </sql>

    <sql id="deleteStaff">
        <![CDATA[
        delete from staff_white_list where staff_id =:staffId and store_code =:storeCode
        ]]>
    </sql>

    <sql id="updateDeleteFalgByStaff">
        <![CDATA[
            update
                staff_white_list
            set
                delete_falg =:deleteFlagLeave
            where
                staff_id in(:staffList)
        ]]>
    </sql>

    <sql id="queryStaffInfoList">
        <![CDATA[
        select
             s.staff_id as staffId,
             s.staff_name as staffName,
             s.store_code as storeCode,
             s.store_name as storeName,
             i.store_address as storeAddress
        from staff_white_list s
        left join store_info i
        on s.store_code = i.store_code
        where s.id in(:idList)
        ]]>
    </sql>

    <sql id="existStaffInfo">
        select count(*)
        from staff_white_list
        where staff_id=:staffId
        and store_code =:storeCode
    </sql>

    <sql id="updateStaffInfo">
        update staff_white_list set
        area_code =:staff.areaCode,
        area_name =:staff.areaName,
        company_code =:staff.companyCode,
        company_name =:staff.companyName,
        station =:staff.station,
        UPDATER =:staff.updater,
        UPDATE_TIME = SYSDATE()
        where staff_id =:staff.staffId
        and store_code =:staff.storeCode
    </sql>
</sqlMap>
