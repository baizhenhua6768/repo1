<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="guide_info_admin" jdbcTimeout="5">
    <!-- 根据工号查询导购数量 -->
    <sql id="countByGuideId">
        <![CDATA[
            SELECT
                COUNT(1)
            FROM
                o2ob_v_guide_info
            WHERE
                GUIDE_ID = :guideId
        ]]>
    </sql>


    <!-- 根据工号查询导购信息 -->
    <sql id="queryByGuideId">
        <![CDATA[
           SELECT
                sd.ID AS id,
                sd.GUIDE_ID AS guideId,
                sd.GUIDE_PHOTO AS guidePhoto,
                sd.GUIDE_NAME AS guideName,
                sd.STORE_CODE AS storeCode,
                ss.NAME AS storeName,
                ss.REGION_NAME AS regionName,
                ss.FINANCE_ORG_ID AS orgId,
                sd.TELE AS tele,
                sd.INTRODUCTION AS introduction,
                sd.SALE_AGE AS saleAge,
                sd.CERTIFICATE AS certificate,
                sd.HIERARCHY AS hierarchy,
                sd.ATTACH AS attach,
                sd.is_vgo AS isVgo,
                ss.ADDRESS AS address,
                sd.business_type as businessType,
                sd.dimission_flag AS dimissionFlag,
                sd.OPEN_FLAG AS openFlag,
                ss.CITY_ID AS cityCode,
                ss.CITY_NAME AS cityName
           FROM
                o2ob_v_guide_info sd
           LEFT JOIN
                o2o_store_detail ss
           ON
                sd.STORE_CODE = ss.STORE_CODE
           WHERE
                sd.GUIDE_ID = :guideId
        ]]>
    </sql>

    <sql id="getGuideInfo">
        <![CDATA[
            SELECT
                ID AS id,
                guide_id AS guideId,
                guide_name AS guideName,
                guide_photo AS guidePhoto,
                star_level AS starLevel,
                introduction AS introduction,
                tele AS tele,
                order_num AS orderNum,
                store_code AS storeCode,
                certificate AS certificate,
                sale_age saleAge,
                business_code as businessCode,
                OPEN_FLAG as openFlag,
                grade as grade,
                outlet_code as outletCode,
                business_type as businessType
            FROM
                o2ob_v_guide_info
            WHERE
                guide_id = :guideId
        ]]>

    </sql>


    <sql id="queryGuideInfoList">
        <![CDATA[
        SELECT
            ID AS id,
            is_vgo AS isVgo,
            open_flag AS openFlag,
            store_code AS storeCode,
            guide_id AS guideId,
            delete_flag AS deleteFlag,
            dimission_flag AS dimissionFlag,
            business_type AS businessType
        FROM
            o2ob_v_guide_info
        WHERE
            GUIDE_ID IN(:guideIdList)
        ]]>
    </sql>

    <!-- 根据条件分页查询导购信息 -->
    <sql id="queryGuideInfoForPage">
        <![CDATA[
            SELECT
                sd.GUIDE_ID AS guideId,
                sd.BUSINESS_TYPE AS businessType,
                sd.GUIDE_NAME AS guideName,
                sd.ORDER_NUM AS orderNum,
                sd.OPEN_FLAG AS openFlag,
                sd.IS_VGO AS isVgo,
                sd.HIERARCHY AS hierarchy,
                sd.ATTACH AS attach,
                ss.NAME AS storeName,
                ss.FINANCE_ORG_ID AS orgId,
                ss.REGION_NAME AS regionName
            FROM
                o2ob_v_guide_info sd
            LEFT JOIN
                o2o_store_detail ss
            ON
                sd.store_code = ss.store_code
            WHERE
                sd.DELETE_FLAG = 0
            AND
                BUSINESS_TYPE = :guideInfoReqDto.businessType
                <#if guideInfoReqDto.isVgo?exists> and sd.IS_VGO=:guideInfoReqDto.isVgo </#if>
                <#if guideInfoReqDto.guideId?exists && guideInfoReqDto.guideId!=""> and sd.GUIDE_ID=:guideInfoReqDto.guideId </#if>
                <#if guideInfoReqDto.guideName?exists && guideInfoReqDto.guideName!=""> and instr(sd.GUIDE_NAME,:guideInfoReqDto.guideName)>0 </#if>
                <#if guideInfoReqDto.openFlag?exists && guideInfoReqDto.openFlag!=""> and sd.OPEN_FLAG=:guideInfoReqDto.openFlag </#if>
                <#if guideInfoReqDto.hierarchy?exists && guideInfoReqDto.hierarchy!=""> and sd.HIERARCHY=:guideInfoReqDto.hierarchy </#if>
                <#if guideInfoReqDto.attach?exists && guideInfoReqDto.attach=="07"> and sd.ATTACH=:guideInfoReqDto.attach </#if>
                <#if guideInfoReqDto.attach?exists && guideInfoReqDto.attach!="07"> and sd.ATTACH!='07' </#if>
                <#if guideInfoReqDto.storeCode?exists && guideInfoReqDto.storeCode!=""> and sd.STORE_CODE=:guideInfoReqDto.storeCode </#if>
                <#if guideInfoReqDto.orgId?exists && guideInfoReqDto.orgId!=""> and ss.FINANCE_ORG_ID=:guideInfoReqDto.orgId </#if>
                <#if guideInfoReqDto.regionId?exists && guideInfoReqDto.regionId!=""> and ss.REGION_ID=:guideInfoReqDto.regionId </#if>
            LIMIT
                :offset, :size
        ]]>
    </sql>
    <!-- 根据条件查询导购信息数量 -->
    <sql id="queryGuideInfoForPage#count">
        <![CDATA[
			SELECT
			    count(1)
			FROM
			    o2ob_v_guide_info sd
			LEFT JOIN
			    o2o_store_detail ss
			ON
			    ss.store_code = sd.store_code
			WHERE
                sd.DELETE_FLAG = 0
			AND
			    BUSINESS_TYPE = :guideInfoReqDto.businessType
                <#if guideInfoReqDto.isVgo?exists> and sd.IS_VGO=:guideInfoReqDto.isVgo </#if>
                <#if guideInfoReqDto.guideId?exists && guideInfoReqDto.guideId!=""> and sd.GUIDE_ID=:guideInfoReqDto.guideId </#if>
                <#if guideInfoReqDto.guideName?exists && guideInfoReqDto.guideName!=""> and instr(sd.GUIDE_NAME,:guideInfoReqDto.guideName)>0 </#if>
                <#if guideInfoReqDto.openFlag?exists && guideInfoReqDto.openFlag!=""> and sd.OPEN_FLAG=:guideInfoReqDto.openFlag </#if>
                <#if guideInfoReqDto.hierarchy?exists && guideInfoReqDto.hierarchy!=""> and sd.HIERARCHY=:guideInfoReqDto.hierarchy </#if>
                <#if guideInfoReqDto.attach?exists && guideInfoReqDto.attach=="07"> and sd.ATTACH=:guideInfoReqDto.attach </#if>
                <#if guideInfoReqDto.attach?exists && guideInfoReqDto.attach!="07"> and sd.ATTACH!='07' </#if>
                <#if guideInfoReqDto.storeCode?exists && guideInfoReqDto.storeCode!=""> and sd.STORE_CODE=:guideInfoReqDto.storeCode </#if>
                <#if guideInfoReqDto.orgId?exists && guideInfoReqDto.orgId!=""> and ss.FINANCE_ORG_ID=:guideInfoReqDto.orgId </#if>
                <#if guideInfoReqDto.regionId?exists && guideInfoReqDto.regionId!=""> and ss.REGION_ID=:guideInfoReqDto.regionId </#if>
    	]]>
    </sql>


    <!-- 根据条件分页查询导购信息 -->
    <sql id="queryGuideInfoPage">
        <![CDATA[
            SELECT
                sd.GUIDE_ID AS guideId,
                sd.BUSINESS_TYPE AS businessType,
                sd.GUIDE_NAME AS guideName,
                sd.ORDER_NUM AS orderNum,
                sd.OPEN_FLAG AS openFlag,
                sd.IS_VGO AS isVgo,
                ss.FINANCE_ORG_ID AS orgId,
                sd.HIERARCHY AS hierarchy,
                sd.ATTACH AS attach,
                ss.NAME AS storeName,
                ss.REGION_NAME AS regionName
            FROM
                o2ob_v_guide_info sd
            LEFT JOIN
                o2o_store_detail ss
            ON
                sd.store_code = ss.store_code
            WHERE
                sd.DELETE_FLAG = 0
            AND
                BUSINESS_TYPE = :guideInfoReqDto.businessType
                <#if guideInfoReqDto.isVgo?exists> and sd.IS_VGO=:guideInfoReqDto.isVgo </#if>
                <#if guideInfoReqDto.guideId?exists && guideInfoReqDto.guideId!=""> and sd.GUIDE_ID=:guideInfoReqDto.guideId </#if>
                <#if guideInfoReqDto.guideName?exists && guideInfoReqDto.guideName!=""> and instr(sd.GUIDE_NAME,:guideInfoReqDto.guideName)>0 </#if>
                <#if guideInfoReqDto.openFlag?exists && guideInfoReqDto.openFlag!=""> and sd.OPEN_FLAG=:guideInfoReqDto.openFlag </#if>
                <#if guideInfoReqDto.hierarchy?exists && guideInfoReqDto.hierarchy!=""> and sd.HIERARCHY not in ("00000290","00000300","00010001","00010002") </#if>
                <#if guideInfoReqDto.attach?exists && guideInfoReqDto.attach=="07"> and sd.ATTACH=:guideInfoReqDto.attach </#if>
                <#if guideInfoReqDto.attach?exists && guideInfoReqDto.attach!="07"> and sd.ATTACH!='07' </#if>
                <#if guideInfoReqDto.storeCode?exists && guideInfoReqDto.storeCode!=""> and sd.STORE_CODE=:guideInfoReqDto.storeCode </#if>
                <#if guideInfoReqDto.orgId?exists && guideInfoReqDto.orgId!=""> and ss.FINANCE_ORG_ID=:guideInfoReqDto.orgId </#if>
                <#if guideInfoReqDto.regionId?exists && guideInfoReqDto.regionId!=""> and ss.REGION_ID=:guideInfoReqDto.regionId </#if>
            LIMIT
                :offset, :size
        ]]>
    </sql>
    <!-- 根据条件查询导购信息数量 -->
    <sql id="queryGuideInfoPage#count">
        <![CDATA[
			SELECT
			    count(1)
			FROM
			    o2ob_v_guide_info sd
			LEFT JOIN
			    o2o_store_detail ss
			ON
			    ss.store_code = sd.store_code
			WHERE
                sd.DELETE_FLAG = 0
			AND
			     BUSINESS_TYPE = :guideInfoReqDto.businessType
                <#if guideInfoReqDto.isVgo?exists> and sd.IS_VGO=:guideInfoReqDto.isVgo </#if>
                <#if guideInfoReqDto.guideId?exists && guideInfoReqDto.guideId!=""> and sd.GUIDE_ID=:guideInfoReqDto.guideId </#if>
                <#if guideInfoReqDto.guideName?exists && guideInfoReqDto.guideName!=""> and instr(sd.GUIDE_NAME,:guideInfoReqDto.guideName)>0 </#if>
                <#if guideInfoReqDto.openFlag?exists && guideInfoReqDto.openFlag!=""> and sd.OPEN_FLAG=:guideInfoReqDto.openFlag </#if>
                <#if guideInfoReqDto.hierarchy?exists && guideInfoReqDto.hierarchy!=""> and sd.HIERARCHY not in ("00000290","00000300","00010001","00010002") </#if>
                <#if guideInfoReqDto.attach?exists && guideInfoReqDto.attach=="07"> and sd.ATTACH=:guideInfoReqDto.attach </#if>
                <#if guideInfoReqDto.attach?exists && guideInfoReqDto.attach!="07"> and sd.ATTACH!='07' </#if>
                <#if guideInfoReqDto.storeCode?exists && guideInfoReqDto.storeCode!=""> and sd.STORE_CODE=:guideInfoReqDto.storeCode </#if>
                <#if guideInfoReqDto.orgId?exists && guideInfoReqDto.orgId!=""> and ss.FINANCE_ORG_ID=:guideInfoReqDto.orgId </#if>
                <#if guideInfoReqDto.regionId?exists && guideInfoReqDto.regionId!=""> and ss.REGION_ID=:guideInfoReqDto.regionId </#if>
    	]]>
    </sql>

    <!-- 获取待处理图片信息 -->
    <sql id="obtainToBeSynPicUrl">
        <![CDATA[
            SELECT
                ID AS id,
                GUIDE_ID AS guideId,
                GUIDE_PHOTO AS guidePhoto
            FROM
                o2ob_v_guide_info
            WHERE
                is_from_moss = 1
            AND
                is_complete_pic_change = 0
    	]]>
    </sql>

    <sql id="findStoreInfo">
        <![CDATA[
            SELECT
                LONGITUDE AS lng,
                LATITUDE AS lat
            FROM
                store_info
            WHERE
                store_code = :storeCode
    	]]>
    </sql>
</sqlMap>